"use strict";(self.webpackChunkreadiness_intelligence=self.webpackChunkreadiness_intelligence||[]).push([[377],{5377:(y,g,o)=>{o.r(g),o.d(g,{MapsModule:()=>P});var h=o(6895),s=o(433),t=o(8256),f=o(6950),l=o(3787),T=o(5795),r=o(1501),u=o(1463),M=o(8423),C=o(7185),z=o(1188);function b(a,n){if(1&a&&(t.TgZ(0,"option",31),t._uU(1),t.qZA()),2&a){const e=n.$implicit;t.s9C("value",e.id),t.xp6(1),t.Oqu(e.name)}}function Z(a,n){1&a&&(t.TgZ(0,"p"),t._uU(1,"Country is Required"),t.qZA())}function A(a,n){if(1&a&&(t.TgZ(0,"div",32),t.YNc(1,Z,2,0,"p",24),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.formControl.countryId.errors.required)}}function S(a,n){if(1&a&&(t.TgZ(0,"option",31),t._uU(1),t.qZA()),2&a){const e=n.$implicit;t.s9C("value",e.id),t.xp6(1),t.Oqu(e.name)}}function I(a,n){1&a&&(t.TgZ(0,"p"),t._uU(1,"Hazard Type is Required"),t.qZA())}function H(a,n){if(1&a&&(t.TgZ(0,"div",32),t.YNc(1,I,2,0,"p",24),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.formControl.hazardTypeId.errors.required)}}function O(a,n){1&a&&(t.TgZ(0,"p"),t._uU(1,"Map Title is Required"),t.qZA())}function x(a,n){if(1&a&&(t.TgZ(0,"div",32),t.YNc(1,O,2,0,"p",24),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.formControl.name.errors.required)}}function U(a,n){1&a&&(t.ynx(0),t.TgZ(1,"tr")(2,"td",33),t._uU(3,"No data found"),t.qZA()(),t.BQk())}function q(a,n){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"tr")(2,"td"),t._uU(3),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td",34)(9,"ul",35)(10,"li",36)(11,"a",37),t.NdJ("click",function(){const p=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.findMapTitle(p.id))}),t._UZ(12,"i",38),t.qZA()(),t.TgZ(13,"li",36)(14,"a",37),t.NdJ("click",function(){const p=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.removeMapTitle(p.id))}),t._UZ(15,"i",39),t.qZA()()()()(),t.BQk()}if(2&a){const e=n.$implicit;t.xp6(3),t.Oqu(e.country?e.country.name:"-"),t.xp6(2),t.Oqu(e.hazardType?e.hazardType.name:"-"),t.xp6(2),t.Oqu(e.name)}}function E(a,n){if(1&a&&(t.TgZ(0,"option",40),t._uU(1),t.qZA()),2&a){const e=n.$implicit,i=t.oxw();t.Q6J("value",e.id)("selected",e.id==i.country),t.xp6(1),t.Oqu(e.name)}}function J(a,n){if(1&a&&(t.TgZ(0,"option",40),t._uU(1),t.qZA()),2&a){const e=n.$implicit,i=t.oxw();t.Q6J("value",e.id)("selected",e.id==i.hazardType),t.xp6(1),t.Oqu(e.name)}}function N(a,n){if(1&a&&(t.TgZ(0,"option",40),t._uU(1),t.qZA()),2&a){const e=n.$implicit,i=t.oxw();t.Q6J("value",e.id)("selected",e.id==i.mapTitle),t.xp6(1),t.Oqu(e.name)}}const v=function(a){return{"is-invalid":a}};let F=(()=>{class a{constructor(e,i,d,p,c,_,w,Y,B,D){this.serviceHazardMapping=e,this.serviceCountry=i,this.serviceHazardType=d,this.serviceHazardMappingTitle=p,this.activatedRoute=c,this.router=_,this.formBuilder=w,this.spinner=Y,this.toastr=B,this.serviceStorage=D,this.incrementId=0,this.country=0,this.hazardType=0,this.mapTitle=0,this.isSelectedCountry=!1,this.isSelectedHazardType=!1,this.isSelectedMapTitle=!1,this.formSubmitted=!1,this.tableMapTitles=[],this.isUpdateSession=!1,this.storage=[],this.activatedRoute.queryParams.subscribe({next:m=>{m.country&&(this.country=m.country),this.isSelectedCountry=!0,m.hazardType&&(this.hazardType=m.hazardType),this.isSelectedHazardType=!0,m.mapTitle&&(this.mapTitle=m.mapTitle),this.isSelectedMapTitle=!0,m.country&&m.hazardType&&this.getHazardMappingTitle(m.country,m.hazardType)}})}get formControl(){return this.form.controls}submitForm(){this.formSubmitted=!0,!this.form.invalid&&(this.isUpdateSession?this.updateMapTitle():this.addMapTitle(),this.formSubmitted=!1,this.form.reset({countryId:"",hazardTypeId:""}))}addMapTitle(){this.spinner.show(),this.serviceHazardMappingTitle.create({countryId:this.form.value.countryId,hazardTypeId:this.form.value.hazardTypeId,name:this.form.value.name}).subscribe({next:()=>{this.getMapTitles()},error:()=>{this.spinner.hide(),this.toastr.error("Failed to save!","Error")},complete:()=>{this.spinner.hide(),this.toastr.success("Data saved successfully!","Success")}})}findMapTitle(e){this.spinner.show(),this.serviceHazardMappingTitle.find(e).subscribe({next:i=>{this.form.patchValue(i)},complete:()=>{this.spinner.hide(),this.mapTitleId=e,this.isUpdateSession=!0}})}updateMapTitle(){this.spinner.show(),this.serviceHazardMappingTitle.update(this.mapTitleId,{countryId:this.form.value.countryId,hazardTypeId:this.form.value.hazardTypeId,name:this.form.value.name}).subscribe({next:()=>{this.getMapTitles()},error:()=>{this.spinner.hide(),this.toastr.error("Failed to update!","Error"),this.mapTitleId=null,this.isUpdateSession=!1},complete:()=>{this.spinner.hide(),this.toastr.success("Data updated successfully!","Success"),this.mapTitleId=null,this.isUpdateSession=!1}})}removeMapTitle(e){this.spinner.show(),this.serviceHazardMappingTitle.delete(e).subscribe({complete:()=>{this.getMapTitles(),this.spinner.hide(),this.toastr.success("Data deleted successfully!","Success")},error:()=>{this.spinner.hide(),this.toastr.error("Failed to delete!","Error")}})}getMapTitles(){}getCountriesAndMapTitles(){this.storage=this.serviceStorage.get("session");let e=JSON.parse(this.storage);this.roleId=e.role.id,1==this.roleId?(this.serviceCountry.getAll().subscribe(i=>{this.countries=i}),this.serviceHazardMappingTitle.getAll().subscribe(i=>{this.tableMapTitles=i})):(this.serviceCountry.find(e.country.id).subscribe(i=>{this.countries=[i]}),this.serviceHazardMappingTitle.getByCountry(e.country.id).subscribe(i=>{this.tableMapTitles=i}))}getHazardTypes(){this.serviceHazardType.getAll().subscribe(e=>{this.hazardTypes=e})}getHazardMappingTitle(e,i){this.hazardMappingTitles=[],this.isSelectedCountry&&this.isSelectedHazardType&&this.serviceHazardMappingTitle.getByCountryAndHazard(e,i).subscribe(d=>{this.hazardMappingTitles=d})}changeCountry(e){this.router.navigate([this.router.url.split("?")[0]],{queryParams:{country:e.value},queryParamsHandling:"merge"}),this.country=e.value,this.isSelectedMapTitle=!1,this.isSelectedCountry=e.value>0,this.getHazardMappingTitle(e.value,this.hazardType),this.getMap()}changeHazardType(e){this.router.navigate([this.router.url.split("?")[0]],{queryParams:{hazardType:e.value},queryParamsHandling:"merge"}),this.hazardType=e.value,this.isSelectedMapTitle=!1,this.isSelectedHazardType=e.value>0,this.getHazardMappingTitle(this.country,e.value),this.getMap()}changeMapTitle(e){this.router.navigate([this.router.url.split("?")[0]],{queryParams:{mapTitle:e.value},queryParamsHandling:"merge"}),this.mapTitle=e.value,this.isSelectedMapTitle=e.value>0,this.getMap()}getMap(){this.geojson&&this.map.removeLayer(this.geojson),this.legend&&this.map.removeControl(this.legend),this.isSelectedCountry&&this.isSelectedHazardType&&this.isSelectedMapTitle?(this.setViewMap(),this.controlLegend()):this.map.setView([43,6],2)}ngOnInit(){this.getCountriesAndMapTitles(),this.getHazardTypes(),this.form=this.formBuilder.group({countryId:["",s.kI.required],hazardTypeId:["",s.kI.required],name:["",s.kI.required]})}ngAfterViewInit(){this.initMap()}ngOnDestroy(){this.map&&this.map.remove()}initMap(){this.map=L.map("mapEditor",{center:L.latLng(43,6),zoom:2}),L.esri.Vector.vectorBasemapLayer("ArcGIS:LightGray",{apikey:"AAPK8acc523775224c1f958527e7933989d1v8h60qdvzoYxwZ9tr466u7fbO5fQavRbW40xv-IvbmkZfa6zjTBE-nvzhBOBPaRv"}).addTo(this.map)}setViewMap(){let e=null;this.serviceCountry.find(this.country).subscribe({next:i=>{this.map.setView([i.latitude,i.longitude],i.mapZoom),e=i.cityJsonFile},complete:()=>{this.myLayer(e)}})}myLayer(e){e&&this.serviceHazardMapping.getByMapTitle(this.mapTitle).subscribe({next:i=>{this.hazardMappings=i},complete:()=>{this.serviceHazardMapping.getCityJson(e).subscribe(i=>{this.geojson=L.geoJSON(i.features,{style:this.style,onEachFeature:this.onEachFeature.bind(this)}).addTo(this.map)})}})}style(){return{weight:1,opacity:1,color:"#a2a2a2",fillOpacity:.6}}onEachFeature(e,i){let d=this.hazardMappings.find(p=>p.featureId==e.id);d&&(console.log("data.level in map comp: ",d.level),4==d.level&&i.setStyle({weight:1,opacity:1,color:"#990000",fillOpacity:.6}),3==d.level&&i.setStyle({weight:1,opacity:1,color:"#f32424",fillOpacity:.6}),2==d.level&&i.setStyle({weight:1,opacity:1,color:"#f77e21",fillOpacity:.6}),1==d.level&&i.setStyle({weight:1,opacity:1,color:"#ffd36e",fillOpacity:.6})),i.on("click",()=>{var p=L.popup().setContent('<div class="fs-16 fw-bold">'+e.properties.name+'</div><div class="mb-2">'+e.properties.NAME_1+'</div><div><select id="chooseHazardLevel'+this.incrementId+'" class="form-select form-select-sm" style="width: 200px"><option>Choose Hazard Level</option><option value="4">High Regular</option><option value="3">High Epidemic</option><option value="2">Medium</option><option value="1">Low</option><option value="0">No Case</option></select></div>');i.bindPopup(p).openPopup()}),i.on("mouseover",()=>{i.bindTooltip(e.properties.name).openTooltip()}),i.on("popupclose",()=>{this.incrementId++}),i.on("popupopen",()=>{let p=L.DomUtil.get("chooseHazardLevel"+this.incrementId);L.DomEvent.on(p,"change",c=>{this.serviceHazardMapping.create({featureId:e.id,level:c.target.value,countryId:this.country,hazardTypeId:this.hazardType,year:2022,hazardMappingTitleId:this.mapTitle}).subscribe(),i.setStyle(4==c.target.value?{weight:1,opacity:1,color:"#990000",fillOpacity:.6}:3==c.target.value?{weight:1,opacity:1,color:"#f32424",fillOpacity:.6}:2==c.target.value?{weight:1,opacity:1,color:"#f77e21",fillOpacity:.6}:1==c.target.value?{weight:1,opacity:1,color:"#ffd36e",fillOpacity:.6}:{weight:1,opacity:1,color:"#a2a2a2",fillOpacity:.6})})})}controlLegend(){this.legend=L.control({position:"bottomright"}),this.legend.onAdd=()=>{var e=L.DomUtil.create("div","map-info map-legend");return e.innerHTML+='<i style="background: #990000"></i> High Regular<br>',e.innerHTML+='<i style="background: #f32424"></i> High Epidemic<br>',e.innerHTML+='<i style="background: #f77e21"></i> Medium<br>',e.innerHTML+='<i style="background: #ffd36e"></i> Low<br>',e.innerHTML+='<i style="background: #a2a2a2"></i> No Case',e},this.legend.addTo(this.map)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(f.g),t.Y36(l.T),t.Y36(T.$),t.Y36(r.m),t.Y36(u.gz),t.Y36(u.F0),t.Y36(s.qu),t.Y36(M.t2),t.Y36(C._W),t.Y36(z.V))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-maps"]],decls:67,vars:20,consts:[[1,"fluid-container"],[1,"col-md-12"],[1,"accordion","m-2","shadow-sm"],[1,"accordion-item"],[1,"accordion-header"],["type","button","data-bs-toggle","collapse","data-bs-target","#collapseMapTitle",1,"accordion-button","collapsed","lh-1","fs-14"],[1,"badge","bg-info","me-2"],["id","collapseMapTitle",1,"accordion-collapse","collapse"],[1,"accordion-body","p-4","fs-12"],[3,"formGroup","ngSubmit"],[1,"mb-3","row"],[1,"col-sm-2","col-form-label"],[1,"col-sm-10"],["formControlName","countryId",1,"form-select","fs-12",3,"ngClass"],["value","","selected",""],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],["formControlName","hazardTypeId",1,"form-select","fs-12",3,"ngClass"],["formControlName","name","type","text",1,"form-control","fs-12",3,"ngClass"],[1,"d-flex","justify-content-end"],["type","submit",1,"btn",2,"background-color","#058FCB","color","white","border","none","font-size","12px"],[1,"table","mb-0","mt-3"],[1,"text-white",2,"background-color","#024664"],["width","100px",1,"text-center"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"col-md-8","m-2","d-flex"],[1,"form-select","me-2","fs-12",3,"change"],["value","0"],[3,"value","selected",4,"ngFor","ngForOf"],["id","mapEditor"],[3,"value"],[1,"invalid-feedback"],["colspan","4"],[1,"text-center"],[1,"nav"],[1,"nav-item"],[1,"btn",3,"click"],[1,"bi","bi-pencil-square"],[1,"bi","bi-trash3"],[3,"value","selected"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4)(5,"button",5),t._UZ(6,"span",6),t._uU(7," CRUD Map Title "),t.qZA()(),t.TgZ(8,"div",7)(9,"div",8)(10,"form",9),t.NdJ("ngSubmit",function(){return i.submitForm()}),t.TgZ(11,"div",10)(12,"label",11),t._uU(13,"Country"),t.qZA(),t.TgZ(14,"div",12)(15,"select",13)(16,"option",14),t._uU(17,"Choose Country"),t.qZA(),t.YNc(18,b,2,2,"option",15),t.qZA(),t.YNc(19,A,2,1,"div",16),t.qZA()(),t.TgZ(20,"div",10)(21,"label",11),t._uU(22,"Hazard Type"),t.qZA(),t.TgZ(23,"div",12)(24,"select",17)(25,"option",14),t._uU(26,"Choose Hazard Type"),t.qZA(),t.YNc(27,S,2,2,"option",15),t.qZA(),t.YNc(28,H,2,1,"div",16),t.qZA()(),t.TgZ(29,"div",10)(30,"label",11),t._uU(31,"Map Title"),t.qZA(),t.TgZ(32,"div",12),t._UZ(33,"input",18),t.YNc(34,x,2,1,"div",16),t.qZA()(),t.TgZ(35,"div",19)(36,"button",20),t._uU(37,"Submit"),t.qZA()()(),t.TgZ(38,"table",21)(39,"thead",22)(40,"tr")(41,"th"),t._uU(42,"Country"),t.qZA(),t.TgZ(43,"th"),t._uU(44,"Hazard Type"),t.qZA(),t.TgZ(45,"th"),t._uU(46,"Map Title"),t.qZA(),t.TgZ(47,"th",23),t._uU(48,"Option"),t.qZA()()(),t.TgZ(49,"tbody"),t.YNc(50,U,4,0,"ng-container",24),t.YNc(51,q,16,3,"ng-container",25),t.qZA()()()()()()(),t.TgZ(52,"div",26)(53,"select",27),t.NdJ("change",function(p){return i.changeCountry(p.target)}),t.TgZ(54,"option",28),t._uU(55,"Choose Country"),t.qZA(),t.YNc(56,E,2,3,"option",29),t.qZA(),t.TgZ(57,"select",27),t.NdJ("change",function(p){return i.changeHazardType(p.target)}),t.TgZ(58,"option",28),t._uU(59,"Choose Hazard Type"),t.qZA(),t.YNc(60,J,2,3,"option",29),t.qZA(),t.TgZ(61,"select",27),t.NdJ("change",function(p){return i.changeMapTitle(p.target)}),t.TgZ(62,"option",28),t._uU(63,"Choose Map Title"),t.qZA(),t.YNc(64,N,2,3,"option",29),t.qZA()(),t.TgZ(65,"div",1),t._UZ(66,"div",30),t.qZA()()),2&e&&(t.xp6(10),t.Q6J("formGroup",i.form),t.xp6(5),t.Q6J("ngClass",t.VKq(14,v,i.formSubmitted&&i.formControl.countryId.errors)),t.xp6(3),t.Q6J("ngForOf",i.countries),t.xp6(1),t.Q6J("ngIf",i.formSubmitted&&i.formControl.countryId.errors),t.xp6(5),t.Q6J("ngClass",t.VKq(16,v,i.formSubmitted&&i.formControl.hazardTypeId.errors)),t.xp6(3),t.Q6J("ngForOf",i.hazardTypes),t.xp6(1),t.Q6J("ngIf",i.formSubmitted&&i.formControl.hazardTypeId.errors),t.xp6(5),t.Q6J("ngClass",t.VKq(18,v,i.formSubmitted&&i.formControl.name.errors)),t.xp6(1),t.Q6J("ngIf",i.formSubmitted&&i.formControl.name.errors),t.xp6(16),t.Q6J("ngIf",0==i.tableMapTitles.length),t.xp6(1),t.Q6J("ngForOf",i.tableMapTitles),t.xp6(5),t.Q6J("ngForOf",i.countries),t.xp6(4),t.Q6J("ngForOf",i.hazardTypes),t.xp6(4),t.Q6J("ngForOf",i.hazardMappingTitles))},dependencies:[h.mk,h.sg,h.O5,s._Y,s.YN,s.Kr,s.Fj,s.EJ,s.JJ,s.JL,s.sg,s.u],styles:["#basemaps-wrapper[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;z-index:400;background:white;padding:10px}#basemaps[_ngcontent-%COMP%]{margin-bottom:5px}#mapEditor[_ngcontent-%COMP%]{height:550px}"]}),a})(),P=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[h.ez,s.u5,s.UX,u.Bz.forChild([{path:"",component:F}])]}),a})()},3787:(y,g,o)=>{o.d(g,{T:()=>f});var h=o(2340),s=o(8256),t=o(529);let f=(()=>{class l{constructor(r){this.httpClient=r,this.url=h.N.apiURL+"/country"}getAll(){return this.httpClient.get(this.url)}getByCode(r){return this.httpClient.get(this.url+"/"+r+"/getbycode")}find(r){return this.httpClient.get(this.url+"/"+r)}create(r){return this.httpClient.post(this.url,r)}update(r,u){return this.httpClient.put(this.url+"/"+r,u)}delete(r){return this.httpClient.delete(this.url+"/"+r)}}return l.\u0275fac=function(r){return new(r||l)(s.LFG(t.eN))},l.\u0275prov=s.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})()},1501:(y,g,o)=>{o.d(g,{m:()=>f});var h=o(2340),s=o(8256),t=o(529);let f=(()=>{class l{constructor(r){this.httpClient=r,this.url=h.N.apiURL+"/hazardmappingtitle"}getByCountryAndHazard(r,u){return this.httpClient.get(`${this.url}/${r}/${u}`)}getByCountry(r){return this.httpClient.get(`${this.url}/${r}/bycountry`)}getAll(){return this.httpClient.get(this.url)}find(r){return this.httpClient.get(this.url+"/"+r)}create(r){return this.httpClient.post(this.url,r)}update(r,u){return this.httpClient.put(this.url+"/"+r,u)}delete(r){return this.httpClient.delete(this.url+"/"+r)}}return l.\u0275fac=function(r){return new(r||l)(s.LFG(t.eN))},l.\u0275prov=s.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})()},5795:(y,g,o)=>{o.d(g,{$:()=>f});var h=o(2340),s=o(8256),t=o(529);let f=(()=>{class l{constructor(r){this.httpClient=r,this.url=h.N.apiURL+"/hazardtype"}getAll(){return this.httpClient.get(this.url)}find(r){return this.httpClient.get(this.url+"/"+r)}create(r){return this.httpClient.post(this.url,r)}update(r,u){return this.httpClient.put(this.url+"/"+r,u)}delete(r){return this.httpClient.delete(this.url+"/"+r)}}return l.\u0275fac=function(r){return new(r||l)(s.LFG(t.eN))},l.\u0275prov=s.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})()}}]);