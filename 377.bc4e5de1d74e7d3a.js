"use strict";(self.webpackChunkreadiness_intelligence=self.webpackChunkreadiness_intelligence||[]).push([[377],{5377:(M,g,s)=>{s.r(g),s.d(g,{MapsModule:()=>Y});var m=s(8692),n=s(9900),e=s(6985),f=s(6950),u=s(3787),T=s(5795),r=s(1501),h=s(1264),_=s(830),C=s(8292),b=s(1188);function z(a,o){if(1&a&&(e.TgZ(0,"option",31),e._uU(1),e.qZA()),2&a){const t=o.$implicit;e.s9C("value",t.id),e.xp6(1),e.Oqu(t.name)}}function Z(a,o){1&a&&(e.TgZ(0,"p"),e._uU(1,"Country is Required"),e.qZA())}function A(a,o){if(1&a&&(e.TgZ(0,"div",32),e.YNc(1,Z,2,0,"p",24),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.formControl.countryId.errors.required)}}function S(a,o){if(1&a&&(e.TgZ(0,"option",31),e._uU(1),e.qZA()),2&a){const t=o.$implicit;e.s9C("value",t.id),e.xp6(1),e.Oqu(t.name)}}function q(a,o){1&a&&(e.TgZ(0,"p"),e._uU(1,"Hazard Type is Required"),e.qZA())}function x(a,o){if(1&a&&(e.TgZ(0,"div",32),e.YNc(1,q,2,0,"p",24),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.formControl.hazardTypeId.errors.required)}}function H(a,o){1&a&&(e.TgZ(0,"p"),e._uU(1,"Map Title is Required"),e.qZA())}function I(a,o){if(1&a&&(e.TgZ(0,"div",32),e.YNc(1,H,2,0,"p",24),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.formControl.name.errors.required)}}function O(a,o){1&a&&(e.ynx(0),e.TgZ(1,"tr")(2,"td",33),e._uU(3,"No data found"),e.qZA()(),e.BQk())}function U(a,o){if(1&a){const t=e.EpF();e.ynx(0),e.TgZ(1,"tr")(2,"td"),e._uU(3),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.qZA(),e.TgZ(8,"td",34)(9,"ul",35)(10,"li",36)(11,"a",37),e.NdJ("click",function(){const l=e.CHM(t).$implicit,d=e.oxw();return e.KtG(d.findMapTitle(l.id))}),e._UZ(12,"i",38),e.qZA()(),e.TgZ(13,"li",36)(14,"a",37),e.NdJ("click",function(){const l=e.CHM(t).$implicit,d=e.oxw();return e.KtG(d.removeMapTitle(l.id))}),e._UZ(15,"i",39),e.qZA()()()()(),e.BQk()}if(2&a){const t=o.$implicit;e.xp6(3),e.Oqu(t.country?t.country.name:"-"),e.xp6(2),e.Oqu(t.hazardType?t.hazardType.name:"-"),e.xp6(2),e.Oqu(t.name)}}function J(a,o){if(1&a&&(e.TgZ(0,"option",40),e._uU(1),e.qZA()),2&a){const t=o.$implicit,i=e.oxw();e.Q6J("value",t.id)("selected",t.id==i.country),e.xp6(1),e.Oqu(t.name)}}function w(a,o){if(1&a&&(e.TgZ(0,"option",40),e._uU(1),e.qZA()),2&a){const t=o.$implicit,i=e.oxw();e.Q6J("value",t.id)("selected",t.id==i.hazardType),e.xp6(1),e.Oqu(t.name)}}function N(a,o){if(1&a&&(e.TgZ(0,"option",40),e._uU(1),e.qZA()),2&a){const t=o.$implicit,i=e.oxw();e.Q6J("value",t.id)("selected",t.id==i.mapTitle),e.xp6(1),e.Oqu(t.name)}}const y=function(a){return{"is-invalid":a}};let F=(()=>{class a{constructor(t,i,p,l,d,v,E,Q,P,B){this.serviceHazardMapping=t,this.serviceCountry=i,this.serviceHazardType=p,this.serviceHazardMappingTitle=l,this.activatedRoute=d,this.router=v,this.formBuilder=E,this.spinner=Q,this.toastr=P,this.serviceStorage=B,this.incrementId=0,this.country=0,this.hazardType=0,this.mapTitle=0,this.isSelectedCountry=!1,this.isSelectedHazardType=!1,this.isSelectedMapTitle=!1,this.formSubmitted=!1,this.tableMapTitles=[],this.isUpdateSession=!1,this.storage=[],this.activatedRoute.queryParams.subscribe({next:c=>{c.country&&(this.country=c.country),this.isSelectedCountry=!0,c.hazardType&&(this.hazardType=c.hazardType),this.isSelectedHazardType=!0,c.mapTitle&&(this.mapTitle=c.mapTitle),this.isSelectedMapTitle=!0,c.country&&c.hazardType&&this.getHazardMappingTitle(c.country,c.hazardType)}})}get formControl(){return this.form.controls}submitForm(){this.formSubmitted=!0,!this.form.invalid&&(this.isUpdateSession?this.updateMapTitle():this.addMapTitle(),this.formSubmitted=!1,this.form.reset({countryId:"",hazardTypeId:""}))}addMapTitle(){this.spinner.show(),this.serviceHazardMappingTitle.create({countryId:this.form.value.countryId,hazardTypeId:this.form.value.hazardTypeId,name:this.form.value.name}).subscribe({next:()=>{this.getMapTitles()},error:()=>{this.spinner.hide(),this.toastr.error("Failed to save!","Error")},complete:()=>{this.spinner.hide(),this.toastr.success("Data saved successfully!","Success")}})}findMapTitle(t){this.spinner.show(),this.serviceHazardMappingTitle.find(t).subscribe({next:i=>{this.form.patchValue(i)},complete:()=>{this.spinner.hide(),this.mapTitleId=t,this.isUpdateSession=!0}})}updateMapTitle(){this.spinner.show(),this.serviceHazardMappingTitle.update(this.mapTitleId,{countryId:this.form.value.countryId,hazardTypeId:this.form.value.hazardTypeId,name:this.form.value.name}).subscribe({next:()=>{this.getMapTitles()},error:()=>{this.spinner.hide(),this.toastr.error("Failed to update!","Error"),this.mapTitleId=null,this.isUpdateSession=!1},complete:()=>{this.spinner.hide(),this.toastr.success("Data updated successfully!","Success"),this.mapTitleId=null,this.isUpdateSession=!1}})}removeMapTitle(t){this.spinner.show(),this.serviceHazardMappingTitle.delete(t).subscribe({complete:()=>{this.getMapTitles(),this.spinner.hide(),this.toastr.success("Data deleted successfully!","Success")},error:()=>{this.spinner.hide(),this.toastr.error("Failed to delete!","Error")}})}getMapTitles(){}getCountriesAndMapTitles(){this.storage=this.serviceStorage.get("session");let t=JSON.parse(this.storage);this.roleId=t.role.id,1==this.roleId?(this.serviceCountry.getAll().subscribe(i=>{this.countries=i}),this.serviceHazardMappingTitle.getAll().subscribe(i=>{this.tableMapTitles=i})):(this.serviceCountry.find(t.country.id).subscribe(i=>{this.countries=[i]}),this.serviceHazardMappingTitle.getByCountry(t.country.id).subscribe(i=>{this.tableMapTitles=i}))}getHazardTypes(){this.serviceHazardType.getAll().subscribe(t=>{this.hazardTypes=t})}getHazardMappingTitle(t,i){this.hazardMappingTitles=[],this.isSelectedCountry&&this.isSelectedHazardType&&this.serviceHazardMappingTitle.getByCountryAndHazard(t,i).subscribe(p=>{this.hazardMappingTitles=p})}changeCountry(t){this.router.navigate([this.router.url.split("?")[0]],{queryParams:{country:t.value},queryParamsHandling:"merge"}),this.country=t.value,this.isSelectedMapTitle=!1,this.isSelectedCountry=t.value>0,this.getHazardMappingTitle(t.value,this.hazardType),this.getMap()}changeHazardType(t){this.router.navigate([this.router.url.split("?")[0]],{queryParams:{hazardType:t.value},queryParamsHandling:"merge"}),this.hazardType=t.value,this.isSelectedMapTitle=!1,this.isSelectedHazardType=t.value>0,this.getHazardMappingTitle(this.country,t.value),this.getMap()}changeMapTitle(t){this.router.navigate([this.router.url.split("?")[0]],{queryParams:{mapTitle:t.value},queryParamsHandling:"merge"}),this.mapTitle=t.value,this.isSelectedMapTitle=t.value>0,this.getMap()}getMap(){this.geojson&&this.map.removeLayer(this.geojson),this.legend&&this.map.removeControl(this.legend),this.isSelectedCountry&&this.isSelectedHazardType&&this.isSelectedMapTitle?(this.setViewMap(),this.controlLegend()):this.map.setView([43,6],2)}ngOnInit(){this.getCountriesAndMapTitles(),this.getHazardTypes(),this.form=this.formBuilder.group({countryId:["",n.kI.required],hazardTypeId:["",n.kI.required],name:["",n.kI.required]})}ngAfterViewInit(){this.initMap()}ngOnDestroy(){this.map&&this.map.remove()}initMap(){this.map=L.map("mapEditor",{center:L.latLng(43,6),zoom:2}),L.esri.Vector.vectorBasemapLayer("ArcGIS:LightGray",{apikey:"AAPK8acc523775224c1f958527e7933989d1v8h60qdvzoYxwZ9tr466u7fbO5fQavRbW40xv-IvbmkZfa6zjTBE-nvzhBOBPaRv"}).addTo(this.map)}setViewMap(){let t=null;this.serviceCountry.find(this.country).subscribe({next:i=>{this.map.setView([i.latitude,i.longitude],i.mapZoom),t=i.cityJsonFile},complete:()=>{this.myLayer(t)}})}myLayer(t){t&&this.serviceHazardMapping.getByMapTitle(this.mapTitle).subscribe({next:i=>{this.hazardMappings=i},complete:()=>{this.serviceHazardMapping.getCityJson(t).subscribe(i=>{this.geojson=L.geoJSON(i.features,{style:this.style,onEachFeature:this.onEachFeature.bind(this)}).addTo(this.map)})}})}style(){return{weight:1,opacity:1,color:"#a2a2a2",fillOpacity:.6}}onEachFeature(t,i){let p=this.hazardMappings.find(l=>l.featureId==t.id);p&&(console.log("data.level in map comp: ",p.level),4==p.level&&i.setStyle({weight:1,opacity:1,color:"#990000",fillOpacity:.6}),3==p.level&&i.setStyle({weight:1,opacity:1,color:"#f32424",fillOpacity:.6}),2==p.level&&i.setStyle({weight:1,opacity:1,color:"#f77e21",fillOpacity:.6}),1==p.level&&i.setStyle({weight:1,opacity:1,color:"#ffd36e",fillOpacity:.6})),i.on("click",()=>{var l=L.popup().setContent('<div class="fs-16 fw-bold">'+t.properties.name+'</div><div class="mb-2">'+t.properties.NAME_1+'</div><div><select id="chooseHazardLevel'+this.incrementId+'" class="form-select form-select-sm" style="width: 200px"><option>Choose Hazard Level</option><option value="4">High Regular</option><option value="3">High Epidemic</option><option value="2">Medium</option><option value="1">Low</option><option value="0">No Case</option></select></div>');i.bindPopup(l).openPopup()}),i.on("mouseover",()=>{i.bindTooltip(t.properties.name).openTooltip()}),i.on("popupclose",()=>{this.incrementId++}),i.on("popupopen",()=>{let l=L.DomUtil.get("chooseHazardLevel"+this.incrementId);L.DomEvent.on(l,"change",d=>{this.serviceHazardMapping.create({featureId:t.id,level:d.target.value,countryId:this.country,hazardTypeId:this.hazardType,year:2022,hazardMappingTitleId:this.mapTitle}).subscribe(),i.setStyle(4==d.target.value?{weight:1,opacity:1,color:"#990000",fillOpacity:.6}:3==d.target.value?{weight:1,opacity:1,color:"#f32424",fillOpacity:.6}:2==d.target.value?{weight:1,opacity:1,color:"#f77e21",fillOpacity:.6}:1==d.target.value?{weight:1,opacity:1,color:"#ffd36e",fillOpacity:.6}:{weight:1,opacity:1,color:"#a2a2a2",fillOpacity:.6})})})}controlLegend(){this.legend=L.control({position:"bottomright"}),this.legend.onAdd=()=>{var t=L.DomUtil.create("div","map-info map-legend");return t.innerHTML+='<i style="background: #990000"></i> High Regular<br>',t.innerHTML+='<i style="background: #f32424"></i> High Epidemic<br>',t.innerHTML+='<i style="background: #f77e21"></i> Medium<br>',t.innerHTML+='<i style="background: #ffd36e"></i> Low<br>',t.innerHTML+='<i style="background: #a2a2a2"></i> No Case',t},this.legend.addTo(this.map)}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(f.g),e.Y36(u.T),e.Y36(T.$),e.Y36(r.m),e.Y36(h.gz),e.Y36(h.F0),e.Y36(n.qu),e.Y36(_.t2),e.Y36(C._W),e.Y36(b.V))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-maps"]],decls:67,vars:20,consts:[[1,"fluid-container"],[1,"col-md-12"],[1,"accordion","m-2","shadow-sm"],[1,"accordion-item"],[1,"accordion-header"],["type","button","data-bs-toggle","collapse","data-bs-target","#collapseMapTitle",1,"accordion-button","collapsed","lh-1","fs-14"],[1,"badge","bg-info","me-2"],["id","collapseMapTitle",1,"accordion-collapse","collapse"],[1,"accordion-body","p-4","fs-12"],[3,"formGroup","ngSubmit"],[1,"mb-3","row"],[1,"col-sm-2","col-form-label"],[1,"col-sm-10"],["formControlName","countryId",1,"form-select","fs-12",3,"ngClass"],["value","","selected",""],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],["formControlName","hazardTypeId",1,"form-select","fs-12",3,"ngClass"],["formControlName","name","type","text",1,"form-control","fs-12",3,"ngClass"],[1,"d-flex","justify-content-end"],["type","submit",1,"btn",2,"background-color","#058FCB","color","white","border","none","font-size","12px"],[1,"table","mb-0","mt-3"],[1,"text-white",2,"background-color","#024664"],["width","100px",1,"text-center"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"col-md-8","m-2","d-flex"],[1,"form-select","me-2","fs-12",3,"change"],["value","0"],[3,"value","selected",4,"ngFor","ngForOf"],["id","mapEditor"],[3,"value"],[1,"invalid-feedback"],["colspan","4"],[1,"text-center"],[1,"nav"],[1,"nav-item"],[1,"btn",3,"click"],[1,"bi","bi-pencil-square"],[1,"bi","bi-trash3"],[3,"value","selected"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4)(5,"button",5),e._UZ(6,"span",6),e._uU(7," CRUD Map Title "),e.qZA()(),e.TgZ(8,"div",7)(9,"div",8)(10,"form",9),e.NdJ("ngSubmit",function(){return i.submitForm()}),e.TgZ(11,"div",10)(12,"label",11),e._uU(13,"Country"),e.qZA(),e.TgZ(14,"div",12)(15,"select",13)(16,"option",14),e._uU(17,"Choose Country"),e.qZA(),e.YNc(18,z,2,2,"option",15),e.qZA(),e.YNc(19,A,2,1,"div",16),e.qZA()(),e.TgZ(20,"div",10)(21,"label",11),e._uU(22,"Hazard Type"),e.qZA(),e.TgZ(23,"div",12)(24,"select",17)(25,"option",14),e._uU(26,"Choose Hazard Type"),e.qZA(),e.YNc(27,S,2,2,"option",15),e.qZA(),e.YNc(28,x,2,1,"div",16),e.qZA()(),e.TgZ(29,"div",10)(30,"label",11),e._uU(31,"Map Title"),e.qZA(),e.TgZ(32,"div",12),e._UZ(33,"input",18),e.YNc(34,I,2,1,"div",16),e.qZA()(),e.TgZ(35,"div",19)(36,"button",20),e._uU(37,"Submit"),e.qZA()()(),e.TgZ(38,"table",21)(39,"thead",22)(40,"tr")(41,"th"),e._uU(42,"Country"),e.qZA(),e.TgZ(43,"th"),e._uU(44,"Hazard Type"),e.qZA(),e.TgZ(45,"th"),e._uU(46,"Map Title"),e.qZA(),e.TgZ(47,"th",23),e._uU(48,"Option"),e.qZA()()(),e.TgZ(49,"tbody"),e.YNc(50,O,4,0,"ng-container",24),e.YNc(51,U,16,3,"ng-container",25),e.qZA()()()()()()(),e.TgZ(52,"div",26)(53,"select",27),e.NdJ("change",function(l){return i.changeCountry(l.target)}),e.TgZ(54,"option",28),e._uU(55,"Choose Country"),e.qZA(),e.YNc(56,J,2,3,"option",29),e.qZA(),e.TgZ(57,"select",27),e.NdJ("change",function(l){return i.changeHazardType(l.target)}),e.TgZ(58,"option",28),e._uU(59,"Choose Hazard Type"),e.qZA(),e.YNc(60,w,2,3,"option",29),e.qZA(),e.TgZ(61,"select",27),e.NdJ("change",function(l){return i.changeMapTitle(l.target)}),e.TgZ(62,"option",28),e._uU(63,"Choose Map Title"),e.qZA(),e.YNc(64,N,2,3,"option",29),e.qZA()(),e.TgZ(65,"div",1),e._UZ(66,"div",30),e.qZA()()),2&t&&(e.xp6(10),e.Q6J("formGroup",i.form),e.xp6(5),e.Q6J("ngClass",e.VKq(14,y,i.formSubmitted&&i.formControl.countryId.errors)),e.xp6(3),e.Q6J("ngForOf",i.countries),e.xp6(1),e.Q6J("ngIf",i.formSubmitted&&i.formControl.countryId.errors),e.xp6(5),e.Q6J("ngClass",e.VKq(16,y,i.formSubmitted&&i.formControl.hazardTypeId.errors)),e.xp6(3),e.Q6J("ngForOf",i.hazardTypes),e.xp6(1),e.Q6J("ngIf",i.formSubmitted&&i.formControl.hazardTypeId.errors),e.xp6(5),e.Q6J("ngClass",e.VKq(18,y,i.formSubmitted&&i.formControl.name.errors)),e.xp6(1),e.Q6J("ngIf",i.formSubmitted&&i.formControl.name.errors),e.xp6(16),e.Q6J("ngIf",0==i.tableMapTitles.length),e.xp6(1),e.Q6J("ngForOf",i.tableMapTitles),e.xp6(5),e.Q6J("ngForOf",i.countries),e.xp6(4),e.Q6J("ngForOf",i.hazardTypes),e.xp6(4),e.Q6J("ngForOf",i.hazardMappingTitles))},dependencies:[m.mk,m.sg,m.O5,n._Y,n.YN,n.Kr,n.Fj,n.EJ,n.JJ,n.JL,n.sg,n.u],styles:["#basemaps-wrapper[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;z-index:400;background:white;padding:10px}#basemaps[_ngcontent-%COMP%]{margin-bottom:5px}#mapEditor[_ngcontent-%COMP%]{height:550px}"]}),a})(),Y=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[m.ez,n.u5,n.UX,h.Bz.forChild([{path:"",component:F}])]}),a})()},1501:(M,g,s)=>{s.d(g,{m:()=>f});var m=s(2340),n=s(6985),e=s(5732);let f=(()=>{class u{constructor(r){this.httpClient=r,this.url=m.N.apiURL+"/hazardmappingtitle"}getByCountryAndHazard(r,h){return this.httpClient.get(`${this.url}/${r}/${h}`)}getByCountry(r){return this.httpClient.get(`${this.url}/${r}/bycountry`)}getAll(){return this.httpClient.get(this.url)}find(r){return this.httpClient.get(this.url+"/"+r)}create(r){return this.httpClient.post(this.url,r)}update(r,h){return this.httpClient.put(this.url+"/"+r,h)}delete(r){return this.httpClient.delete(this.url+"/"+r)}}return u.\u0275fac=function(r){return new(r||u)(n.LFG(e.eN))},u.\u0275prov=n.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()}}]);